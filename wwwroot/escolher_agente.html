<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Facility.IA - Seleção</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="config.js"></script> 
    <script src="script.js"></script>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* --- ESTILOS GERAIS --- */
        body { margin: 0; overflow: hidden; background: #050507; font-family: 'Segoe UI', sans-serif; }
        .chat-layout { display: grid; grid-template-columns: 280px 1fr; height: 100vh; width: 100vw; }
        .sidebar { background: rgba(15, 17, 21, 0.95); border-right: 1px solid rgba(255,255,255,0.05); display: flex; flex-direction: column; padding: 20px; z-index: 20; }
        
        /* --- ESTILOS DO HISTÓRICO (PREMIUM DESIGN) --- */
        .new-chat-btn { background: rgba(0, 255, 136, 0.05); border: 1px dashed var(--primary); color: var(--primary); padding: 12px; border-radius: 12px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 10px; font-weight: bold; margin-bottom: 25px; letter-spacing: 0.5px; }
        .new-chat-btn:hover { background: var(--primary-dim); box-shadow: 0 0 20px rgba(0, 255, 136, 0.15); transform: translateY(-2px); }
        
        .history-list { flex: 1; overflow-y: auto; padding-right: 5px; margin-right: -10px; padding-right: 10px; }
        .history-list::-webkit-scrollbar { width: 4px; }
        .history-list::-webkit-scrollbar-track { background: transparent; }
        .history-list::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        .history-group { margin-bottom: 25px; animation: fadeIn 0.5s ease; }
        .history-label { font-size: 0.7rem; color: #555; font-weight: 700; margin-bottom: 12px; padding-left: 10px; text-transform: uppercase; letter-spacing: 1px; }
        
        .history-item { 
            padding: 12px 15px; 
            border-radius: 12px; 
            cursor: pointer; 
            color: #a0a0b0; 
            font-size: 0.9rem; 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); 
            border: 1px solid transparent; 
            background: rgba(255, 255, 255, 0.02); 
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        /* Efeito Hover Sofisticado */
        .history-item:hover { 
            background: rgba(255, 255, 255, 0.06); 
            color: white; 
            border-color: rgba(255, 255, 255, 0.08); 
            transform: translateX(4px); 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .history-item.active { 
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.08), transparent); 
            color: var(--primary); 
            border-left: 3px solid var(--primary); 
            border-radius: 4px 12px 12px 4px; 
        }

        .history-item i { font-size: 1rem; color: #444; transition: 0.3s; min-width: 20px; text-align: center; }
        .history-item:hover i { color: var(--primary); text-shadow: 0 0 10px var(--primary-dim); }
        .history-item.active i { color: var(--primary); }
        
        .history-text { 
            overflow: hidden; 
            text-overflow: ellipsis; 
            white-space: nowrap; 
            width: 100%; 
            font-weight: 500;
        }

        .delete-chat-btn { 
            position: absolute; 
            right: 10px; 
            color: #ff5555; 
            background: #161b22; /* Fundo para tapar o texto ao aparecer */
            padding: 5px; 
            border-radius: 4px;
            opacity: 0; 
            transform: scale(0.8) translateX(10px); 
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            box-shadow: -10px 0 15px #161b22; /* Fade visual */
        }
        
        .history-item:hover .delete-chat-btn { 
            opacity: 1; 
            transform: scale(1) translateX(0); 
            display: block; 
        }
        .delete-chat-btn:hover { background: #ff5555; color: white; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- LAYOUT DA SELEÇÃO --- */
        .selection-screen { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding: 40px; overflow-y: auto; background: radial-gradient(circle at center, #1a1a2e 0%, #050507 80%); width: 100%; height: 100%; }
        
        .search-wrapper { position: relative; width: 100%; max-width: 650px; margin: 0 auto 50px auto; z-index: 10; }
        .search-input { width: 100%; padding: 22px 60px 22px 30px; border-radius: 50px; background: rgba(22, 27, 34, 0.6); border: 1px solid rgba(255,255,255,0.1); color: white; font-size: 1.15rem; transition: all 0.3s; backdrop-filter: blur(12px); box-shadow: 0 15px 35px rgba(0,0,0,0.3); }
        .search-input:focus { border-color: var(--primary); background: rgba(22, 27, 34, 0.9); box-shadow: 0 0 0 4px rgba(0, 255, 136, 0.1), 0 15px 35px rgba(0,0,0,0.5); outline: none; transform: translateY(-2px); }
        .search-icon { position: absolute; right: 25px; top: 50%; transform: translateY(-50%); color: #666; font-size: 1.3rem; pointer-events: none; transition: 0.3s; }
        .search-input:focus + .search-icon { color: var(--primary); text-shadow: 0 0 15px var(--primary); transform: translateY(-50%) scale(1.1); }

        .professions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; width: 100%; max-width: 1100px; padding-bottom: 60px; }
        .pro-card { background: rgba(254, 255, 255, 0.03); border: 1px solid rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; cursor: pointer; transition: 0.2s; text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 130px; gap: 10px; }
        .pro-card:hover { border-color: var(--primary); background: rgba(0, 255, 136, 0.05); transform: translateY(-5px); }
        .pro-card i { font-size: 1.8rem; color: #fff; margin-bottom: 5px; }
        .pro-card span { font-size: 0.8rem; color: #aaa; font-weight: 500; line-height: 1.3; }
        .pro-card:hover span { color: white; }

        @media (max-width: 768px) {
            .chat-layout { grid-template-columns: 1fr; }
            .sidebar { display: none; }
            .search-input { padding: 18px 50px 18px 20px; font-size: 1rem; }
        }
    </style>
</head>
<body>
    <div class="chat-layout">
        <aside class="sidebar" id="mainSidebar">
            <div class="logo" style="margin-bottom: 30px;"><a href="dashboard.html" style="text-decoration:none; color:inherit;"><h1>FACILITY<span>.IA</span></h1></a></div>
            
            <div class="new-chat-btn" onclick="location.reload()"><i class="fas fa-plus"></i> Nova Seleção</div>
            
            <div class="history-list" id="historyList"></div>

            <div style="margin-top: auto; padding-top: 15px; border-top:1px solid rgba(255,255,255,0.1); color:white; display:flex; gap:10px; align-items:center;">
                <div style="width:30px; height:30px; background:var(--primary); border-radius:50%; display:flex; justify-content:center; align-items:center; color:black; font-weight:bold;">U</div>
                <div style="font-size:0.9rem;">USUARIO</div>
            </div>
        </aside>

        <main style="position: relative; width: 100%; height: 100%; overflow: hidden;">
            <div id="selectionScreen" class="selection-screen">
                <div style="text-align:center; margin-bottom:40px; margin-top: 20px;">
                    <h2 style="color: #ffffff; font-size: 2rem; margin-bottom: 10px;">Quem você quer contratar?</h2>
                    <p style="color:#888;">Nossa equipe de IA está pronta. Escolha seu especialista.</p>
                </div>
                
                <div class="search-wrapper">
                    <input type="text" id="searchProfissao" class="search-input" placeholder="Digite o cargo (ex: Advogado, Dev, Médico)...">
                    <i class="fas fa-search search-icon"></i>
                </div>

                <div class="professions-grid" id="professionsGrid"></div>
            </div>
        </main>
    </div>

    <script>
        const rawProfessions = [
            { name: "Advogado Civil", icon: "fa-scale-balanced", area: "juridico" }, { name: "Advogado Trabalhista", icon: "fa-briefcase", area: "juridico" },
            { name: "Advogado Criminalista", icon: "fa-handcuffs", area: "juridico" }, { name: "Advogado Tributarista", icon: "fa-file-invoice-dollar", area: "juridico" },
            { name: "Advogado Imobiliário", icon: "fa-house-chimney", area: "juridico" }, { name: "Advogado de Família", icon: "fa-people-roof", area: "juridico" },
            { name: "Advogado Digital/LGPD", icon: "fa-laptop-code", area: "juridico" }, { name: "Advogado Ambiental", icon: "fa-tree", area: "juridico" },
            { name: "Advogado Corporativo", icon: "fa-building", area: "juridico" }, { name: "Advogado Previdenciário", icon: "fa-person-cane", area: "juridico" },
            { name: "Juiz / Magistrado", icon: "fa-gavel", area: "juridico" }, { name: "Promotor de Justiça", icon: "fa-book-atlas", area: "juridico" },
            { name: "Defensor Público", icon: "fa-shield-halved", area: "juridico" }, { name: "Oficial de Cartório", icon: "fa-stamp", area: "juridico" },
            { name: "Paralegal", icon: "fa-folder-open", area: "juridico" },
            { name: "Médico Clínico Geral", icon: "fa-user-doctor", area: "saude" }, { name: "Cardiologista", icon: "fa-heart-pulse", area: "saude" },
            { name: "Dermatologista", icon: "fa-hand-dots", area: "saude" }, { name: "Pediatra", icon: "fa-baby", area: "saude" },
            { name: "Ortopedista", icon: "fa-bone", area: "saude" }, { name: "Ginecologista", icon: "fa-person-pregnant", area: "saude" },
            { name: "Psiquiatra", icon: "fa-brain", area: "saude" }, { name: "Neurologista", icon: "fa-bolt", area: "saude" },
            { name: "Cirurgião Plástico", icon: "fa-scalpel", area: "saude" }, { name: "Oftalmologista", icon: "fa-eye", area: "saude" },
            { name: "Dentista Geral", icon: "fa-tooth", area: "saude" }, { name: "Ortodontista", icon: "fa-teeth", area: "saude" },
            { name: "Implantodontista", icon: "fa-screwdriver", area: "saude" }, { name: "Psicólogo Clínico", icon: "fa-comments", area: "saude" },
            { name: "Nutricionista", icon: "fa-apple-whole", area: "saude" }, { name: "Fisioterapeuta", icon: "fa-person-walking", area: "saude" },
            { name: "Enfermeiro(a)", icon: "fa-user-nurse", area: "saude" }, { name: "Farmacêutico", icon: "fa-pills", area: "saude" },
            { name: "Médico Veterinário", icon: "fa-dog", area: "saude" }, { name: "Personal Trainer", icon: "fa-dumbbell", area: "saude" },
            { name: "Dev. Front-End", icon: "fa-desktop", area: "tech" }, { name: "Dev. Back-End", icon: "fa-server", area: "tech" },
            { name: "Dev. FullStack", icon: "fa-layer-group", area: "tech" }, { name: "Dev. Mobile (iOS)", icon: "fa-apple", area: "tech" },
            { name: "Dev. Mobile (Android)", icon: "fa-android", area: "tech" }, { name: "DevOps Engineer", icon: "fa-infinity", area: "tech" },
            { name: "Engenheiro de Dados", icon: "fa-database", area: "tech" }, { name: "Cientista de Dados", icon: "fa-chart-pie", area: "tech" },
            { name: "Analista de Segurança", icon: "fa-user-secret", area: "tech" }, { name: "Arquiteto de Software", icon: "fa-sitemap", area: "tech" },
            { name: "QA / Tester", icon: "fa-bug-slash", area: "tech" }, { name: "Product Manager (PM)", icon: "fa-clipboard-check", area: "tech" },
            { name: "Scrum Master", icon: "fa-rotate", area: "tech" }, { name: "Dev. Blockchain", icon: "fa-bitcoin-sign", area: "tech" },
            { name: "Dev. de Jogos", icon: "fa-gamepad", area: "tech" }, { name: "Engenheiro de IA", icon: "fa-robot", area: "tech" },
            { name: "UX Designer", icon: "fa-pen-nib", area: "tech" }, { name: "UI Designer", icon: "fa-palette", area: "tech" },
            { name: "Admin de Redes", icon: "fa-network-wired", area: "tech" }, { name: "Suporte Técnico", icon: "fa-headset", area: "tech" },
            { name: "Engenheiro Civil", icon: "fa-helmet-safety", area: "engenharia" }, { name: "Engenheiro Elétrico", icon: "fa-bolt", area: "engenharia" },
            { name: "Engenheiro Mecânico", icon: "fa-gears", area: "engenharia" }, { name: "Engenheiro de Produção", icon: "fa-industry", area: "engenharia" },
            { name: "Engenheiro Químico", icon: "fa-flask", area: "engenharia" }, { name: "Engenheiro Agrônomo", icon: "fa-wheat-awn", area: "engenharia" },
            { name: "Engenheiro Ambiental", icon: "fa-leaf", area: "engenharia" }, { name: "Eng. de Segurança", icon: "fa-shield", area: "engenharia" },
            { name: "Arquiteto Urbanista", icon: "fa-city", area: "engenharia" }, { name: "Designer de Interiores", icon: "fa-couch", area: "engenharia" },
            { name: "Paisagista", icon: "fa-tree-city", area: "engenharia" }, { name: "Topógrafo", icon: "fa-mountain-sun", area: "engenharia" },
            { name: "Contador", icon: "fa-calculator", area: "negocios" }, { name: "Auditor Fiscal", icon: "fa-magnifying-glass-dollar", area: "negocios" },
            { name: "Analista Financeiro", icon: "fa-chart-line", area: "negocios" }, { name: "Consultor de Investimentos", icon: "fa-sack-dollar", area: "negocios" },
            { name: "Trader", icon: "fa-arrow-trend-up", area: "negocios" }, { name: "Economista", icon: "fa-money-bill-transfer", area: "negocios" },
            { name: "Gestor de RH", icon: "fa-users", area: "negocios" }, { name: "Recrutador / Headhunter", icon: "fa-user-plus", area: "negocios" },
            { name: "Business Partner", icon: "fa-handshake", area: "negocios" }, { name: "Gerente de Projetos", icon: "fa-timeline", area: "negocios" },
            { name: "Corretor de Imóveis", icon: "fa-house", area: "negocios" }, { name: "Corretor de Seguros", icon: "fa-file-shield", area: "negocios" },
            { name: "Consultor Empresarial", icon: "fa-briefcase", area: "negocios" }, { name: "CEO / Executivo", icon: "fa-user-tie", area: "negocios" },
            { name: "Vendedor B2B", icon: "fa-phone", area: "negocios" }, { name: "Gestor de Logística", icon: "fa-truck-fast", area: "operacional" },
            { name: "Comprador / Supply", icon: "fa-cart-shopping", area: "operacional" }, { name: "Representante Comercial", icon: "fa-suitcase", area: "negocios" },
            { name: "Copywriter", icon: "fa-feather", area: "criativos" }, { name: "Redator SEO", icon: "fa-keyboard", area: "criativos" },
            { name: "Social Media Manager", icon: "fa-hashtag", area: "criativos" }, { name: "Gestor de Tráfego", icon: "fa-bullhorn", area: "criativos" },
            { name: "Designer Gráfico", icon: "fa-pen-ruler", area: "criativos" }, { name: "Diretor de Arte", icon: "fa-palette", area: "criativos" },
            { name: "Editor de Vídeo", icon: "fa-film", area: "criativos" }, { name: "Motion Designer", icon: "fa-play", area: "criativos" },
            { name: "Fotógrafo", icon: "fa-camera", area: "criativos" }, { name: "Jornalista", icon: "fa-newspaper", area: "criativos" },
            { name: "Roteirista", icon: "fa-scroll", area: "criativos" }, { name: "Tradutor", icon: "fa-language", area: "criativos" },
            { name: "Revisor de Texto", icon: "fa-glasses", area: "criativos" }, { name: "Produtor Musical", icon: "fa-music", area: "criativos" },
            { name: "Influenciador Digital", icon: "fa-star", area: "criativos" },
            { name: "Professor Fundamental", icon: "fa-chalkboard-user", area: "educacao" }, { name: "Professor Universitário", icon: "fa-graduation-cap", area: "educacao" },
            { name: "Pesquisador Acadêmico", icon: "fa-microscope", area: "educacao" }, { name: "Pedagogo", icon: "fa-shapes", area: "educacao" },
            { name: "Professor de Idiomas", icon: "fa-earth-americas", area: "educacao" }, { name: "Orientador Vocacional", icon: "fa-compass", area: "educacao" },
            { name: "Bibliotecário", icon: "fa-book", area: "educacao" }, { name: "Estudante", icon: "fa-backpack", area: "educacao" },
            { name: "Chef de Cozinha", icon: "fa-utensils", area: "operacional" }, { name: "Nutricionista Gastronômico", icon: "fa-carrot", area: "operacional" },
            { name: "Organizador de Eventos", icon: "fa-champagne-glasses", area: "operacional" }, { name: "Agente de Viagens", icon: "fa-plane", area: "operacional" },
            { name: "Piloto de Avião", icon: "fa-plane-up", area: "operacional" }, { name: "Policial / Segurança", icon: "fa-shield-cat", area: "operacional" },
            { name: "Bombeiro Civil", icon: "fa-fire-extinguisher", area: "operacional" }, { name: "Síndico Profissional", icon: "fa-building-user", area: "operacional" }
        ];

        const grid = document.getElementById('professionsGrid');

        document.addEventListener('DOMContentLoaded', async () => {
            renderGrid();
            renderHistoryFromStorage();
            await loadCustomAgents();
        });

        function getHistory() {
            return JSON.parse(localStorage.getItem('chatHistory') || '[]');
        }

        function saveHistory(history) {
            localStorage.setItem('chatHistory', JSON.stringify(history));
        }

        function deleteChat(id, event) {
            event.stopPropagation();
            if(confirm('Excluir esta conversa?')) {
                let history = getHistory();
                history = history.filter(h => h.id !== id);
                saveHistory(history);
                renderHistoryFromStorage();
            }
        }

        function renderHistoryFromStorage() {
            const container = document.getElementById('historyList');
            const history = getHistory();
            const groups = { 'Hoje': [], 'Ontem': [], '7 Dias Anteriores': [], 'Mais Antigos': [] };
            
            history.sort((a, b) => b.timestamp - a.timestamp).forEach(chat => {
                const date = new Date(chat.timestamp);
                const now = new Date();
                const diffTime = Math.abs(now - date);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays <= 1 && date.getDate() === now.getDate()) groups['Hoje'].push(chat);
                else if (diffDays <= 2) groups['Ontem'].push(chat);
                else if (diffDays <= 7) groups['7 Dias Anteriores'].push(chat);
                else groups['Mais Antigos'].push(chat);
            });

            container.innerHTML = "";
            for (const [label, chats] of Object.entries(groups)) {
                if (chats.length > 0) {
                    let html = `<div class="history-group"><div class="history-label">${label}</div>`;
                    chats.forEach(chat => {
                        html += `
                            <div class="history-item" onclick="loadChatSession('${chat.id}', '${chat.agentName}', '${chat.icon}')">
                                <i class="fas ${chat.icon}"></i>
                                <span class="history-text">${chat.title}</span>
                                <i class="fas fa-trash delete-chat-btn" onclick="deleteChat('${chat.id}', event)"></i>
                            </div>`;
                    });
                    html += `</div>`;
                    container.innerHTML += html;
                }
            }
        }

        function loadChatSession(id, name, icon) {
            const params = new URLSearchParams();
            params.append('name', name);
            params.append('icon', icon);
            params.append('resumeSession', id);
            window.location.href = `chatcomIA.html?${params.toString()}`;
        }

        function renderGrid(filterText = "") {
            grid.innerHTML = "";
            const filtered = rawProfessions.filter(p => p.name.toLowerCase().includes(filterText.toLowerCase()));
            
            filtered.forEach(prof => {
                const card = document.createElement('div');
                card.className = 'pro-card';
                if(prof.area === 'meus_agentes') card.style.borderColor = 'var(--primary)';
                card.innerHTML = `<i class="fas ${prof.icon}"></i><span>${prof.name}</span>`;
                card.onclick = () => {
                    const params = new URLSearchParams();
                    params.append('name', prof.name);
                    params.append('icon', prof.icon);
                    params.append('area', prof.area || 'geral');
                    window.location.href = `chatcomIA.html?${params.toString()}`;
                };
                grid.appendChild(card);
            });
        }

        document.getElementById('searchProfissao').addEventListener('input', (e) => renderGrid(e.target.value));

        async function loadCustomAgents() {
            try {
                const userData = JSON.parse(localStorage.getItem('userData'));
                const userId = userData ? userData.Id : 0;
                if(typeof CONFIG === 'undefined' || !CONFIG.API_URL) return;
                const response = await fetch(`${CONFIG.API_URL}/api/agents?userId=${userId}`);
                const agents = await response.json();
                const myAgents = agents.filter(a => a.creatorId !== null);
                if(myAgents.length > 0) {
                    myAgents.forEach(agent => {
                        rawProfessions.unshift({ name: agent.name, icon: "fa-robot", area: "meus_agentes" });
                    });
                    renderGrid();
                }
            } catch (error) { console.error("Erro loading agents", error); }
        }
    </script>
</body>
</html>